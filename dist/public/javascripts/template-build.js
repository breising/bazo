var tB_Object={array:[]},blocksObject={templated_blocks:[]},delete_block_flag="",minToLabel=function(e){var t=Number(e/60).toFixed(2).split(".")[0],l=Number(Number(e/60).toFixed(3).split(".")[1])/1e3*60;l=Math.round(l),Number(l)<10&&(l="0"+String(l));var a="";return a=t<1?(t="12","AM"):11<t&t<13?"PM":12<t?(t=Number(t)-12,"PM"):"AM",String(t)+":"+String(l)+String(a)},drop=function(){},deleteTBlock=function(e){"edit_mode"==delete_block_flag?$.ajax({type:"POST",url:"/template-build-delete-block?id="+e,success:function(e){console.log(e),repaintTemplateBlocks()}}):alert("Select 'Edit' to make changes.")},repaintTemplateBlocks=function(){clearTemplate_Blocks();var e=Number($(".id_template").val());$.ajax({type:"POST",url:"/template-build-repaint-blocks?templateid="+e,success:function(e){tB_Object=e}})},clearTemplate_Blocks=function(){for(x=420;x<=1140;x+=5)for(y=1;y<=15;y++){var e=y,t=String(e)+"_"+String(x);0<$("."+t).children().length&&($("."+t).children().remove(),$("."+t).css("background-color","white"),$("."+t).html(e+"."+minToLabel(x)))}},paintBlocks=function(e){for(x=0;x<e.array.length;x++){var t=Number(e.array[x].starttime),l=Number(e.array[x].starttime)+Number(e.array2[x].duration),a=String(e.array[x].chair),i=String(e.array2[x].name),r=Number(e.array[x].blockid),o=String(e.array2[x].color),n=(Number(e.array[x].templateid),Number(e.array[x].id)),c="";for(y=t;y<=l;y+=5)c=String(a)+"_"+String(y),$("."+c).children().length;for(z=t;z<=l;z+=5){if(c=String(a)+"_"+String(z),z==t)var d="<div><strong>"+String(a)+"."+String(i)+"."+minToLabel(Number(z))+"</strong></div>";else d="<div>"+String(a)+"."+String(i)+"."+minToLabel(Number(z))+"</div>";var s='<div id="blockid">'+r+'</div><div id="starttime">'+t+'</div><div id="chair">'+a+'</div><div class="delete-block" id='+n+' onclick="deleteTBlock(this.id)">Delete block<div class="templateBlockid" style="display:none">'+n+"</div></div>";$("."+c).html(d+s),$("."+c).css("background-color",o),$("."+c).mouseover(function(){$(this).find(".delete-block").css("top",y),$(this).find(".delete-block").css("left",x),$(this).find(".delete-block").show()}),$("."+c).mouseleave(function(){$(this).find(".delete-block").hide()})}}},refresh_template_list=function(e){$(".id_template").val(templateObject.templates[e].id),$(".name_template").val(templateObject.templates[e].name),$(".description_template").val(templateObject.templates[e].description),$(".jscolor").val(templateObject.templates[e].color),$(".noselect").css("background-color",templateObject.templates[e].color)},getTBlocks=function(e){$.ajax({type:"POST",url:"/template-build-templateBlocks",success:function(e){tB_Object=e}})};$(document).ready(function(){var e=function(){$(".block-item-contain").draggable({disabled:!0}),$(".time-box").droppable({disabled:!0}),$(".name_template").attr("readonly",!0),$(".description_template").attr("readonly",!0),$(".name_template").css("background-color","#f2f2f2"),$(".description_template").css("background-color","#f2f2f2")},t=0;$(".next_template").click(function(){delete_block_flag="",t>=templateObject.templates.length-1?t=0:t+=1,e(),refresh_template_list(t),repaintTemplateBlocks()});$(".back_template").click(function(){delete_block_flag="",t<=0?t=templateObject.templates.length-1:t-=1,e(),refresh_template_list(t),repaintTemplateBlocks()}),$(".new_template").click(function(){delete_block_flag="",$(".save_template").show(),$(".color").show(),$(".save_template").click(function(){o()}),$(".jscolor").val(""),clearTemplate_Blocks(),n(),i(),a()}),$(".edit_template").click(function(){delete_block_flag="edit_mode",i(),l(),c(),$(".save_edits").show(),$(".color").show(),$(".save_edits").click(function(){r()})});var l=function(){console.log("activateDragDrop"),$(".block-item-contain").draggable({helper:"clone"}),$(".time-box").droppable({greedy:!0,hoverClass:"drop-hover",tolerance:"pointer"}),$(".block-item-contain").draggable({disabled:!1}),$(".time-box").droppable({disabled:!1})},a=function(){console.log("disableDragDrop"),$(".block-item-contain").draggable({helper:"clone"}),$(".time-box").droppable({greedy:!0,hoverClass:"drop-hover",tolerance:"pointer"}),$(".block-item-contain").draggable({disabled:!0}),$(".time-box").droppable({disabled:!0})},i=function(){$(".name_template").attr("readonly",!1),$(".description_template").attr("readonly",!1),$(".name_template").css("background-color","#c6ecc6"),$(".description_template").css("background-color","#c6ecc6")},n=function(){$(".id_template").val(""),$(".name_template").val(""),$(".description_template").val("")},r=function(){return o("edit_flag")},o=function(e){if("edit_flag"==e){var t=e,l=$(".id_template").val();if(""==l||null==l||null==l)return alert("To edit there must be a Template ID.")}var a=$(".name_template").val(),i=$(".description_template").val(),r=$(".jscolor").val();if((delete_block_flag="")==a||null==a||null==a)return alert("Name and Description are required.");$(".block-item-contain").draggable({disabled:!0}),$(".time-box").droppable({disabled:!0}),$(".name_template").attr("readonly",!0),$(".description_template").attr("readonly",!0),$(".name_template").css("background-color","#f2f2f2"),$(".description_template").css("background-color","#f2f2f2");var o="/template-save-title?name="+a+"&description="+i+"&id="+l+"&edit_flag="+t+"&color="+r;$(".save_template").hide(),$(".save_edits").hide(),$.ajax({type:"POST",url:o,success:function(e){var l;l=e,templateObject.templates=[],Object.keys(l).forEach(function(e,t){templateObject.templates.push(l[e])}),n(),repaintTemplateBlocks(),console.log("From Ajax success")}})},c=function(){$(".time-box").on("drop",function(e,t){var l,a,i,r=Number((l=this,a=String($(l).text()),i=(i=$(l).text()).split(":")[0].split(".")[1],i=60*Number(i),a=a.split(":")[1],a=Number(a[0]+a[1]),Number(i+a))),o=$(this).text().split(".")[0];if(NaN!=r&&null!=r&&null!=r&&""!=r){console.log("This from onDropTemplate: min= "+r);var n=t.draggable.attr("id"),c=t.draggable.find(".block-item-duration").text(),d=t.draggable.find(".block-item-name").text(),s=t.draggable.find(".block-item-color").text(),m=Number($(".id_template").val()),p={};p.start_time=Number(r),p.block_id=Number(n),p.chair_id=Number(o),p.template_id=Number(m),p.color=String(s);var b=r+Number(c);for(x=r;x<=b;x+=5){var u=String(o)+"_"+String(x);if(0<$("."+u).children().length)return alert("Sorry. That spot is already occupied.")}$.ajax({type:"POST",url:"/template-save-blocks",dataType:"json",data:p,success:function(e){console.log("The server says: "+e)}}),$(this).droppable("option","disabled",!0);u="";for(x=r;x<=b;x+=5){if(u=String(o)+"_"+String(x),x==r)var g="<div><strong>"+String(o)+"."+String(d)+"."+minToLabel(Number(x))+"</strong></div>";else g="<div>"+String(o)+"."+String(d)+"."+minToLabel(Number(x))+"</div>";var f='<div id="blockid">'+n+'</div><div id="starttime">'+r+'</div><div id="chair">'+o+'</div><div id="color">'+s+"</div>";$("."+u).html(g+f),$("."+u).droppable("option","disabled",!0),$("."+u).css("background-color",s)}}})}});